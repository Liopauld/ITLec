// Prisma schema for ITPathfinder
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String             @id @default(uuid())
  name             String
  email            String             @unique
  password         String
  role             String
  bio              String?
  github           String?
  linkedin         String?
  skillsVector     Json?
  xp               Int                @default(0)
  level            Int                @default(1)
  badges           String[]           @default([])
  reputation       Int                @default(0)
  coins            Int                @default(0)
  profilePicture   String?
  emailVerified    Boolean            @default(false)
  verificationToken String?
  verificationTokenExpiry DateTime?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  profiles         Profile[]
  assessments      Assessment[]
  trackProgresses  TrackProgress[]
  posts            Post[]
  comments         Comment[]
  postLikes        PostLike[]
  certificates     Certificate[]
  sessionRequests  SessionRequest[]   @relation("StudentRequests")
  mentorSessions   SessionRequest[]   @relation("MentorSessions")
  personalEvents   PersonalCalendarEvent[]
  createdEvents    Event[]            @relation("EventCreator")
  eventRegistrations EventRegistration[] @relation("UserRegistrations")
  createdTracks    Track[]            @relation("TrackCreator")

  @@map("User")
}

model Profile {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  education String?
  location  String?
  profilePicture String?

  @@map("Profile")
}

model Assessment {
  id                 String   @id @default(uuid())
  user               User     @relation(fields: [userId], references: [id])
  userId             String
  createdAt          DateTime @default(now())
  scoreVector        Json
  rawAnswers         Json
  strengths          String[] @default([])
  weaknesses         String[] @default([])
  recommendedTracks  Json?
  aiAnalysis         String?
  aiFeedback         String?
  aiCareerPath       String?
  aiNextSteps        String?

  @@map("Assessment")
}

model Question {
  id       String   @id @default(uuid())
  stem     String
  type     String
  tags     String[]
  options  Json
  correct  Json?
  weight   Float
  quiz     Quiz?    @relation(fields: [quizId], references: [id])
  quizId   String?

  @@map("Question")
}

model Track {
  id             String          @id @default(uuid())
  title          String
  description    String
  difficulty     String
  category       String?
  prerequisites  Json?
  creatorId      String?
  creator        User?           @relation("TrackCreator", fields: [creatorId], references: [id])
  modules        Module[]
  games          Game[]
  trackProgresses TrackProgress[]
  certificates   Certificate[]

  @@map("Track")
}

model Module {
  id        String   @id @default(uuid())
  track     Track    @relation(fields: [trackId], references: [id])
  trackId   String
  title     String?
  type      String
  content   Json?
  order     Int      @default(0)
  coinReward Int     @default(10)
  hintCost   Int     @default(5)
  hints      Json?
  lessons   Lesson[]
  games     Game[]
  quizzes   Quiz[]

  @@map("Module")
}

model Lesson {
  id        String   @id @default(uuid())
  module    Module   @relation(fields: [moduleId], references: [id])
  moduleId  String
  title     String?
  content   Json
  assets    Json?
  order     Int      @default(0)

  @@map("Lesson")
}

model Game {
  id        String   @id @default(uuid())
  module    Module?  @relation(fields: [moduleId], references: [id])
  moduleId  String?
  track     Track?   @relation(fields: [trackId], references: [id])
  trackId   String?
  name      String?
  title     String?
  type      String
  content   Json
  order     Int      @default(0)

  @@map("Game")
}

model TrackProgress {
  id               String   @id @default(uuid())
  user             User     @relation(fields: [userId], references: [id])
  userId           String
  track            Track    @relation(fields: [trackId], references: [id])
  trackId          String
  completedModules String[] @default([])
  completedGames   String[] @default([])
  achievements     Json?
  startedAt        DateTime?
  updatedAt        DateTime?

  @@map("TrackProgress")
}

model Certificate {
  id         String   @id @default(uuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  track      Track    @relation(fields: [trackId], references: [id])
  trackId    String
  issueDate  DateTime @default(now())
  certCode   String   @unique

  @@map("Certificate")
}

model Post {
  id         String    @id @default(uuid())
  user       User      @relation(fields: [userId], references: [id])
  userId     String
  content    String
  tags       String[]  @default([])
  mediaUrl   String?
  mediaType  String?
  likes      Int       @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  comments   Comment[]
  postLikes  PostLike[]

  @@map("Post")
}

model Comment {
  id        String   @id @default(uuid())
  post      Post     @relation(fields: [postId], references: [id])
  postId    String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("Comment")
}

model PostLike {
  id        String   @id @default(uuid())
  post      Post     @relation(fields: [postId], references: [id])
  postId    String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime @default(now())

  @@unique([postId, userId])
  @@map("PostLike")
}

model SessionRequest {
  id          String   @id @default(uuid())
  student     User     @relation("StudentRequests", fields: [studentId], references: [id])
  studentId   String
  mentor      User     @relation("MentorSessions", fields: [mentorId], references: [id])
  mentorId    String
  topic       String?
  message     String?
  description String?
  status      String   @default("pending")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("SessionRequest")
}

model PersonalCalendarEvent {
  id          String   @id @default(uuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  title       String
  description String?
  type        String?
  relatedId   String?
  startTime   DateTime
  endTime     DateTime
  isAllDay    Boolean  @default(false)
  color       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("PersonalCalendarEvent")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  type      String
  title     String
  message   String
  relatedId String?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("Notification")
}

model Event {
  id            String              @id @default(uuid())
  title         String
  description   String?
  type          String
  startTime     DateTime
  endTime       DateTime
  location      String?
  virtualLink   String?
  maxAttendees  Int?
  capacity      Int?
  creatorId     String?
  creator       User?               @relation("EventCreator", fields: [creatorId], references: [id])
  status        String?
  tags          String[]            @default([])
  imageUrl      String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  registrations EventRegistration[]

  @@map("Event")
}

model EventRegistration {
  id           String   @id @default(uuid())
  event        Event    @relation(fields: [eventId], references: [id])
  eventId      String
  user         User     @relation("UserRegistrations", fields: [userId], references: [id])
  userId       String
  status       String   @default("registered")
  registeredAt DateTime @default(now())
  createdAt    DateTime @default(now())

  @@unique([eventId, userId])
  @@map("EventRegistration")
}

model Quiz {
  id        String     @id @default(uuid())
  module    Module     @relation(fields: [moduleId], references: [id])
  moduleId  String
  questions Question[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("Quiz")
}

model Session {
  id          String   @id @default(uuid())
  mentorId    String
  studentId   String
  title       String?
  topic       String
  description String?
  meetingLink String?
  notes       String?
  status      String
  startTime   DateTime
  endTime     DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("Session")
}
